function d3_datacube(){function e(){}var t={},n=[],r="_",a="id",u=new d3.datacube.menu;return u.datacube(e),e.add=function(e,n,r){return r="undefined"!=typeof r?r:"null",t[n]||(t[n]={}),t[n][r]=e,u.update(),this},e.mergeWith=function(e){if(!e.keys().compare(this.keys()))return this;for(var t=0;t<Object.keys(e.variables()).length;t++)for(var n=Object.keys(e.variables())[t],r=0;r<e.variables()[n].length;r++){var a=e.variables()[n][r],u=e.get(n,a);this.add(u,n,a)}},e.keys=function(){return n},e.ySeparator=function(e){return arguments.length?(r=e,this):r},e.idColumn=function(e){return arguments.length?(a=e,this):a},e.menu=function(){return u},e.variables=function(){for(var e={},n=0;n<Object.keys(t).length;n++){for(var r=Object.keys(t)[n],a=[],u=0;u<Object.keys(t[r]).length;u++)a.push(Object.keys(t[r])[u]);e[r]=a}return e},e.array=function(e){if(!arguments.length)return this._getArray;var t=Object.keys(e[0]);t.splice(t.indexOf(a),1);for(var u=0;u<e.length;u++)n.push(e[u][a]);for(var u=0;u<t.length;u++){var i,c,o=t[u],l={};2==o.split(r).length?(i=o.split(r)[0],c=o.split(r)[1]):i=o;for(var s=0;s<e.length;s++)l[e[s][a]]=parseFloat(e[s][o]);_m=d3.map(l),c?this.add(_m,i,c):this.add(_m,i)}return this},e.get=function(e,n){return n="undefined"!=typeof n?n:"null",t[e][n]?t[e][n]:this},e}function d3_datacube_menu(){function e(){}var t,n,r,a=function(){};return e.variableId=function(e){return arguments.length?(n=e,this):n},e.yearId=function(e){return arguments.length?(r=e,this):r},e.datacube=function(e){return arguments.length?(t=e,this):t},e.updater=function(e){return arguments.length?(a=e,this):a},e.update=function(){n&&(d3.select("#"+n).selectAll("option").remove(),d3.select("#"+n).selectAll("option").data(Object.keys(t.variables())).enter().append("option").attr("value",function(e){return e}).text(function(e){return e}),d3.select("#"+n).on("change",function(){a.call()}),this.updateYear())},e.updateYear=function(){if(r){var e=document.getElementById(n);d3.select("#"+r).selectAll("option").remove(),d3.select("#"+r).selectAll("option").data(t.variables()[e.options[e.selectedIndex].value]).enter().append("option").attr("value",function(e){return e}).text(function(e){return e}),d3.select("#"+r).on("change",function(){a.call()})}},e.selected=function(){var e=document.getElementById(n),t=document.getElementById(r),a=e.options[e.selectedIndex].value,u=t.options[t.selectedIndex].value;return cube.get(a,u)},e}Array.prototype.compare=function(e){if(this.length!=e.length)return!1;for(var t=0;t<e.length;t++){if(this[t].compare&&!this[t].compare(e[t]))return!1;if(this[t]!==e[t])return!1}return!0},d3.datacube=function(){var e=new d3_datacube;return e},d3.datacube.menu=function(){var e=new d3_datacube_menu;return e};